#!/usr/bin/env bash

set -euo pipefail
DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )/.." &> /dev/null && pwd)"
cd "$DIR"

_help() (
  cat <<EOF
Usage: $(basename ${0}) cmd

where cmd is one of:

help     Displays this help text.
sync     Replaces files in this repos with links to \$HOME.
EOF
)

_sync() (
  cd home
  for file_in_repo in $(find . -type f); do
    file_in_home=$HOME/${file_in_repo/"/dot/"/}
    mkdir -p $(dirname $file_in_home)
    touch $file_in_home
    rm -f $file_in_repo
    ln $file_in_home $file_in_repo
  done
)

_main() (
  case "${1:-}" in
    help|sync)
      _$1
      ;;
    *)
      _help
      exit 1
      ;;
  esac
)

_main $@
